
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User-Provided Mesh Example &#8212; OpenAeroStruct 2.3.2 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="More Examples" href="more_examples.html" />
    <link rel="prev" title="Aerostructural with Wingbox Walkthrough" href="aerostructural_wingbox_walkthrough.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="more_examples.html" title="More Examples"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="aerostructural_wingbox_walkthrough.html" title="Aerostructural with Wingbox Walkthrough"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.3.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">User-Provided Mesh Example</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="user-provided-mesh-example">
<span id="custom-mesh"></span><h1>User-Provided Mesh Example<a class="headerlink" href="#user-provided-mesh-example" title="Permalink to this headline">Â¶</a></h1>
<p>Here is an example script with a custom mesh provided as an array of coordinates.
This should help you understand how meshes are defined in OpenAeroStruct and how to create them for your own custom planform shapes.
This is an alternative to the helper-function approach described in <a class="reference internal" href="aero_walkthrough.html#aerodynamic-optimization-walkthrough"><span class="std std-ref">Aerodynamic Optimization Walkthrough</span></a>.</p>
<p>The following shows the portion of the example script in which the user provides the coordinates for the mesh.
This example is for a wing with a kink and two distinct trapezoidal segments.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># CUSTOM MESH: Example mesh for a 2-segment wing with sweep</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Planform specifications</span>
<span class="n">half_span</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c1"># wing half-span in m</span>
<span class="n">kink_location</span> <span class="o">=</span> <span class="mf">4.0</span>  <span class="c1"># spanwise location of the kink in m</span>

<span class="n">root_chord</span> <span class="o">=</span> <span class="mf">6.0</span>  <span class="c1"># root chord in m</span>
<span class="n">kink_chord</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># kink chord in m</span>
<span class="n">tip_chord</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># tip chord in m</span>

<span class="n">inboard_LE_sweep</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># inboard leading-edge sweep angle in deg</span>
<span class="n">outboard_LE_sweep</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span>  <span class="c1"># outboard leading-edge sweep angle in deg</span>

<span class="c1"># Mesh specifications</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># number of chordwise nodal points (should be odd)</span>
<span class="n">ny_outboard</span> <span class="o">=</span> <span class="mi">9</span>  <span class="c1"># number of spanwise nodal points for the outboard segment</span>
<span class="n">ny_inboard</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># number of spanwise nodal points for the inboard segment</span>

<span class="c1"># Initialize the 3-D mesh object. Indexing: Chordwise, spanwise, then the 3-D coordinates.</span>
<span class="c1"># We use ny_inboard+ny_outboard-1 because the 2 segments share the nodes where they connect.</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># The form of this 3-D array can be confusing initially.</span>
<span class="c1"># For each node, we are providing the x, y, and z coordinates.</span>
<span class="c1"># x is streamwise, y is spanwise, and z is up.</span>
<span class="c1"># For example, the node for the leading edge at the tip would be specified as mesh[0, 0, :] = np.array([x, y, z]).</span>
<span class="c1"># And the node at the trailing edge at the root would be mesh[nx-1, ny-1, :] = np.array([x, y, z]).</span>
<span class="c1"># We only provide the right half of the wing here because we use symmetry.</span>
<span class="c1"># Print elements of the mesh to better understand the form.</span>

<span class="c1">####### THE Z-COORDINATES ######</span>
<span class="c1"># Assume no dihedral, so set the z-coordinate for all the points to 0.</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">####### THE Y-COORDINATES ######</span>
<span class="c1"># Using uniform spacing for the spanwise locations of all the nodes within each of the two trapezoidal segments:</span>
<span class="c1"># Outboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ny_outboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">half_span</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>
<span class="c1"># Inboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="n">ny_outboard</span> <span class="p">:</span> <span class="n">ny_outboard</span> <span class="o">+</span> <span class="n">ny_inboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kink_location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">###### THE X-COORDINATES ######</span>
<span class="c1"># Start with the leading edge and create some intermediate arrays that we will use</span>
<span class="n">x_LE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span>
    <span class="n">inboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="p">)</span>

<span class="n">array_for_outboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_span</span> <span class="o">-</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">outboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">x_LE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_leading_edge_x_coord</span>
<span class="n">x_LE</span><span class="p">[</span><span class="n">ny_inboard</span> <span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Then the trailing edge</span>
<span class="n">x_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">root_chord</span><span class="p">,</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span>
    <span class="n">ny_inboard</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">array_for_outboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tip_chord</span><span class="p">,</span>
    <span class="n">ny_outboard</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">x_TE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_trailing_edge_x_coord</span>
<span class="n">x_TE</span><span class="p">[</span><span class="n">ny_inboard</span> <span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_trailing_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># # Quick plot to check leading and trailing edge x-coords</span>
<span class="c1"># plt.plot(x_LE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.plot(x_TE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.show()</span>
<span class="c1"># exit()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">mesh</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_LE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_TE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># END MESH</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
</pre></div>
</div>
<p>The following shows a visualization of the mesh.</p>
<img alt="_images/two_part_mesh.png" src="_images/two_part_mesh.png" />
<p>The complete script for the optimization is as follows.
Make sure you go through the <a class="reference internal" href="aerostructural_wingbox_walkthrough.html#aerostructural-with-wingbox-walkthrough"><span class="std std-ref">Aerostructural with Wingbox Walkthrough</span></a> before trying to understand this setup.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This example script can be used to run a multipoint aerostructural (w/ wingbox) optimization for a custom user-provided mesh.</span>

<span class="sd">The fuel burn from the cruise flight-point is the objective function and a 2.5g</span>
<span class="sd">maneuver flight-point is used for the structural sizing.</span>
<span class="sd">After running the optimization, use the &#39;plot_wingbox.py&#39; script in the utils/</span>
<span class="sd">directory (e.g., as &#39;python ../utils/plot_wingbox.py aerostruct.db&#39; if running</span>
<span class="sd">from this directory) to visualize the results.</span>
<span class="sd">&#39;plot_wingbox.py&#39; is still under development and will probably not work as it is for other types of cases for now.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">openaerostruct.integration.aerostruct_groups</span> <span class="kn">import</span> <span class="n">AerostructGeometry</span><span class="p">,</span> <span class="n">AerostructPoint</span>
<span class="kn">from</span> <span class="nn">openaerostruct.structures.wingbox_fuel_vol_delta</span> <span class="kn">import</span> <span class="n">WingboxFuelVolDelta</span>
<span class="kn">import</span> <span class="nn">openmdao.api</span> <span class="k">as</span> <span class="nn">om</span>


<span class="c1"># docs checkpoint 0</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># CUSTOM MESH: Example mesh for a 2-segment wing with sweep</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Planform specifications</span>
<span class="n">half_span</span> <span class="o">=</span> <span class="mf">12.0</span>  <span class="c1"># wing half-span in m</span>
<span class="n">kink_location</span> <span class="o">=</span> <span class="mf">4.0</span>  <span class="c1"># spanwise location of the kink in m</span>

<span class="n">root_chord</span> <span class="o">=</span> <span class="mf">6.0</span>  <span class="c1"># root chord in m</span>
<span class="n">kink_chord</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># kink chord in m</span>
<span class="n">tip_chord</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># tip chord in m</span>

<span class="n">inboard_LE_sweep</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># inboard leading-edge sweep angle in deg</span>
<span class="n">outboard_LE_sweep</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.0</span>  <span class="c1"># outboard leading-edge sweep angle in deg</span>

<span class="c1"># Mesh specifications</span>
<span class="n">nx</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># number of chordwise nodal points (should be odd)</span>
<span class="n">ny_outboard</span> <span class="o">=</span> <span class="mi">9</span>  <span class="c1"># number of spanwise nodal points for the outboard segment</span>
<span class="n">ny_inboard</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># number of spanwise nodal points for the inboard segment</span>

<span class="c1"># Initialize the 3-D mesh object. Indexing: Chordwise, spanwise, then the 3-D coordinates.</span>
<span class="c1"># We use ny_inboard+ny_outboard-1 because the 2 segments share the nodes where they connect.</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># The form of this 3-D array can be confusing initially.</span>
<span class="c1"># For each node, we are providing the x, y, and z coordinates.</span>
<span class="c1"># x is streamwise, y is spanwise, and z is up.</span>
<span class="c1"># For example, the node for the leading edge at the tip would be specified as mesh[0, 0, :] = np.array([x, y, z]).</span>
<span class="c1"># And the node at the trailing edge at the root would be mesh[nx-1, ny-1, :] = np.array([x, y, z]).</span>
<span class="c1"># We only provide the right half of the wing here because we use symmetry.</span>
<span class="c1"># Print elements of the mesh to better understand the form.</span>

<span class="c1">####### THE Z-COORDINATES ######</span>
<span class="c1"># Assume no dihedral, so set the z-coordinate for all the points to 0.</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">####### THE Y-COORDINATES ######</span>
<span class="c1"># Using uniform spacing for the spanwise locations of all the nodes within each of the two trapezoidal segments:</span>
<span class="c1"># Outboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="p">:</span><span class="n">ny_outboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">half_span</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span>
<span class="c1"># Inboard</span>
<span class="n">mesh</span><span class="p">[:,</span> <span class="n">ny_outboard</span> <span class="p">:</span> <span class="n">ny_outboard</span> <span class="o">+</span> <span class="n">ny_inboard</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">kink_location</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1">###### THE X-COORDINATES ######</span>
<span class="c1"># Start with the leading edge and create some intermediate arrays that we will use</span>
<span class="n">x_LE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_inboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span>
    <span class="n">inboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="p">)</span>

<span class="n">array_for_outboard_leading_edge_x_coord</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">half_span</span> <span class="o">-</span> <span class="n">kink_location</span><span class="p">,</span> <span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">outboard_LE_sweep</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ny_outboard</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">x_LE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_leading_edge_x_coord</span>
<span class="n">x_LE</span><span class="p">[</span><span class="n">ny_inboard</span> <span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># Then the trailing edge</span>
<span class="n">x_TE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">array_for_inboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">root_chord</span><span class="p">,</span>
    <span class="n">array_for_inboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span>
    <span class="n">ny_inboard</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">array_for_outboard_trailing_edge_x_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">kink_chord</span><span class="p">,</span>
    <span class="n">array_for_outboard_leading_edge_x_coord</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tip_chord</span><span class="p">,</span>
    <span class="n">ny_outboard</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">x_TE</span><span class="p">[:</span><span class="n">ny_inboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_inboard_trailing_edge_x_coord</span>
<span class="n">x_TE</span><span class="p">[</span><span class="n">ny_inboard</span> <span class="p">:</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_for_outboard_trailing_edge_x_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="c1"># # Quick plot to check leading and trailing edge x-coords</span>
<span class="c1"># plt.plot(x_LE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.plot(x_TE, np.arange(0, ny_inboard+ny_outboard-1), marker=&#39;*&#39;)</span>
<span class="c1"># plt.show()</span>
<span class="c1"># exit()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ny_inboard</span> <span class="o">+</span> <span class="n">ny_outboard</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">mesh</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_LE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">x_TE</span><span class="p">)[</span><span class="n">i</span><span class="p">],</span> <span class="n">nx</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># END MESH</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># docs checkpoint 1</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># On to the problem setup (this is the same setup used for the Q400 example)</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="c1"># Provide coordinates for a portion of an airfoil for the wingbox cross-section as an nparray with dtype=complex (to work with the complex-step approximation for derivatives).</span>
<span class="c1"># These should be for an airfoil with the chord scaled to 1.</span>
<span class="c1"># We use the 10% to 60% portion of the NASA SC2-0612 airfoil for this case</span>
<span class="c1"># We use the coordinates available from airfoiltools.com. Using such a large number of coordinates is not necessary.</span>
<span class="c1"># The first and last x-coordinates of the upper and lower surfaces must be the same</span>

<span class="c1"># fmt: off</span>
<span class="n">upper_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">lower_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.13</span><span class="p">,</span> <span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">,</span> <span class="mf">0.17</span><span class="p">,</span> <span class="mf">0.18</span><span class="p">,</span> <span class="mf">0.19</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.21</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">,</span> <span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">,</span> <span class="mf">0.27</span><span class="p">,</span> <span class="mf">0.28</span><span class="p">,</span> <span class="mf">0.29</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.31</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">,</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.36</span><span class="p">,</span> <span class="mf">0.37</span><span class="p">,</span> <span class="mf">0.38</span><span class="p">,</span> <span class="mf">0.39</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.41</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.46</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.49</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.52</span><span class="p">,</span> <span class="mf">0.53</span><span class="p">,</span> <span class="mf">0.54</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">,</span> <span class="mf">0.58</span><span class="p">,</span> <span class="mf">0.59</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="n">upper_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="mf">0.0447</span><span class="p">,</span>  <span class="mf">0.046</span><span class="p">,</span>  <span class="mf">0.0472</span><span class="p">,</span>  <span class="mf">0.0484</span><span class="p">,</span>  <span class="mf">0.0495</span><span class="p">,</span>  <span class="mf">0.0505</span><span class="p">,</span>  <span class="mf">0.0514</span><span class="p">,</span>  <span class="mf">0.0523</span><span class="p">,</span>  <span class="mf">0.0531</span><span class="p">,</span>  <span class="mf">0.0538</span><span class="p">,</span> <span class="mf">0.0545</span><span class="p">,</span>  <span class="mf">0.0551</span><span class="p">,</span>  <span class="mf">0.0557</span><span class="p">,</span> <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span> <span class="mf">0.0573</span><span class="p">,</span>  <span class="mf">0.0577</span><span class="p">,</span>  <span class="mf">0.0581</span><span class="p">,</span>  <span class="mf">0.0585</span><span class="p">,</span>  <span class="mf">0.0588</span><span class="p">,</span>  <span class="mf">0.0591</span><span class="p">,</span>  <span class="mf">0.0593</span><span class="p">,</span>  <span class="mf">0.0595</span><span class="p">,</span>  <span class="mf">0.0597</span><span class="p">,</span>  <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0602</span><span class="p">,</span>  <span class="mf">0.0601</span><span class="p">,</span>  <span class="mf">0.06</span><span class="p">,</span>    <span class="mf">0.0599</span><span class="p">,</span>  <span class="mf">0.0598</span><span class="p">,</span>  <span class="mf">0.0596</span><span class="p">,</span>  <span class="mf">0.0594</span><span class="p">,</span>  <span class="mf">0.0592</span><span class="p">,</span>  <span class="mf">0.0589</span><span class="p">,</span>  <span class="mf">0.0586</span><span class="p">,</span>  <span class="mf">0.0583</span><span class="p">,</span>  <span class="mf">0.058</span><span class="p">,</span>   <span class="mf">0.0576</span><span class="p">,</span>  <span class="mf">0.0572</span><span class="p">,</span>  <span class="mf">0.0568</span><span class="p">,</span>  <span class="mf">0.0563</span><span class="p">,</span>  <span class="mf">0.0558</span><span class="p">,</span>  <span class="mf">0.0553</span><span class="p">,</span>  <span class="mf">0.0547</span><span class="p">,</span>  <span class="mf">0.0541</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>  <span class="c1"># noqa: E201, E241</span>
<span class="n">lower_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.0447</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0473</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0496</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0506</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0515</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0524</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0532</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.054</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0547</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.056</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0565</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.057</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0575</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0579</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0583</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0595</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0598</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0597</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0596</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0594</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0592</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0589</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0586</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0578</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0573</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0567</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0561</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0554</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0546</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0538</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0529</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0519</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0509</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0497</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0485</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0472</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0458</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0444</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;complex128&quot;</span><span class="p">)</span>
<span class="c1"># fmt: on</span>

<span class="n">surf_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># Wing definition</span>
    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;wing&quot;</span><span class="p">,</span>  <span class="c1"># name of the surface</span>
    <span class="s2">&quot;symmetry&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, model one half of wing</span>
    <span class="s2">&quot;S_ref_type&quot;</span><span class="p">:</span> <span class="s2">&quot;wetted&quot;</span><span class="p">,</span>  <span class="c1"># how we compute the wing area,</span>
    <span class="c1"># can be &#39;wetted&#39; or &#39;projected&#39;</span>
    <span class="s2">&quot;mesh&quot;</span><span class="p">:</span> <span class="n">mesh</span><span class="p">,</span>
    <span class="s2">&quot;twist_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]),</span>
    <span class="s2">&quot;fem_model_type&quot;</span><span class="p">:</span> <span class="s2">&quot;wingbox&quot;</span><span class="p">,</span>
    <span class="s2">&quot;data_x_upper&quot;</span><span class="p">:</span> <span class="n">upper_x</span><span class="p">,</span>
    <span class="s2">&quot;data_x_lower&quot;</span><span class="p">:</span> <span class="n">lower_x</span><span class="p">,</span>
    <span class="s2">&quot;data_y_upper&quot;</span><span class="p">:</span> <span class="n">upper_y</span><span class="p">,</span>
    <span class="s2">&quot;data_y_lower&quot;</span><span class="p">:</span> <span class="n">lower_y</span><span class="p">,</span>
    <span class="s2">&quot;spar_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;skin_thickness_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.003</span><span class="p">,</span> <span class="mf">0.006</span><span class="p">,</span> <span class="mf">0.010</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">]),</span>  <span class="c1"># [m]</span>
    <span class="s2">&quot;original_wingbox_airfoil_t_over_c&quot;</span><span class="p">:</span> <span class="mf">0.12</span><span class="p">,</span>
    <span class="c1"># Aerodynamic deltas.</span>
    <span class="c1"># These CL0 and CD0 values are added to the CL and CD</span>
    <span class="c1"># obtained from aerodynamic analysis of the surface to get</span>
    <span class="c1"># the total CL and CD.</span>
    <span class="c1"># These CL0 and CD0 values do not vary wrt alpha.</span>
    <span class="c1"># They can be used to account for things that are not included, such as contributions from the fuselage, nacelles, tail surfaces, etc.</span>
    <span class="s2">&quot;CL0&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="s2">&quot;CD0&quot;</span><span class="p">:</span> <span class="mf">0.0142</span><span class="p">,</span>
    <span class="s2">&quot;with_viscous&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute viscous drag</span>
    <span class="s2">&quot;with_wave&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># if true, compute wave drag</span>
    <span class="c1"># Airfoil properties for viscous drag calculation</span>
    <span class="s2">&quot;k_lam&quot;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># percentage of chord with laminar</span>
    <span class="c1"># flow, used for viscous drag</span>
    <span class="s2">&quot;c_max_t&quot;</span><span class="p">:</span> <span class="mf">0.38</span><span class="p">,</span>  <span class="c1"># chordwise location of maximum thickness</span>
    <span class="s2">&quot;t_over_c_cp&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">]),</span>
    <span class="c1"># Structural values are based on aluminum 7075</span>
    <span class="s2">&quot;E&quot;</span><span class="p">:</span> <span class="mf">73.1e9</span><span class="p">,</span>  <span class="c1"># [Pa] Young&#39;s modulus</span>
    <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">73.1e9</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">1.33</span><span class="p">),</span>  <span class="c1"># [Pa] shear modulus (calculated using E and the Poisson&#39;s ratio here)</span>
    <span class="s2">&quot;yield&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">420.0e6</span> <span class="o">/</span> <span class="mf">1.5</span><span class="p">),</span>  <span class="c1"># [Pa] allowable yield stress</span>
    <span class="s2">&quot;mrho&quot;</span><span class="p">:</span> <span class="mf">2.78e3</span><span class="p">,</span>  <span class="c1"># [kg/m^3] material density</span>
    <span class="s2">&quot;strength_factor_for_upper_skin&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>  <span class="c1"># the yield stress is multiplied by this factor for the upper skin</span>
    <span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">:</span> <span class="mf">1.25</span><span class="p">,</span>
    <span class="s2">&quot;exact_failure_constraint&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># if false, use KS function</span>
    <span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;fuel_density&quot;</span><span class="p">:</span> <span class="mf">803.0</span><span class="p">,</span>  <span class="c1"># [kg/m^3] fuel density (only needed if the fuel-in-wing volume constraint is used)</span>
    <span class="s2">&quot;Wf_reserve&quot;</span><span class="p">:</span> <span class="mf">500.0</span><span class="p">,</span>  <span class="c1"># [kg] reserve fuel mass</span>
<span class="p">}</span>

<span class="n">surfaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_dict</span><span class="p">]</span>

<span class="c1"># Create the problem and assign the model group</span>
<span class="n">prob</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">Problem</span><span class="p">()</span>

<span class="c1"># Add problem information as an independent variables component</span>
<span class="n">indep_var_comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">IndepVarComp</span><span class="p">()</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span> <span class="o">*</span> <span class="mf">310.95</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span>
    <span class="s2">&quot;re&quot;</span><span class="p">,</span>
    <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.569</span> <span class="o">*</span> <span class="mf">310.95</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.56</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">),</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="mf">340.294</span> <span class="o">*</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.81206</span> <span class="o">*</span> <span class="mf">1e-5</span><span class="p">)]),</span>
    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/m&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.569</span><span class="p">,</span> <span class="mf">1.225</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg/m**3&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">0.43</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;1/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">2e6</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;W0&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">25400</span> <span class="o">+</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;Wf_reserve&quot;</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">310.95</span><span class="p">,</span> <span class="mf">340.294</span><span class="p">]),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m/s&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">]))</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">)),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
<span class="n">indep_var_comp</span><span class="o">.</span><span class="n">add_output</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mf">3000.0</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;prob_vars&quot;</span><span class="p">,</span> <span class="n">indep_var_comp</span><span class="p">,</span> <span class="n">promotes</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">])</span>

<span class="c1"># Loop over each surface in the surfaces list</span>
<span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

    <span class="c1"># Get the surface name and create a group to contain components</span>
    <span class="c1"># only for this surface</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

    <span class="n">aerostruct_group</span> <span class="o">=</span> <span class="n">AerostructGeometry</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">)</span>

    <span class="c1"># Add group to the problem with the name of the surface.</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aerostruct_group</span><span class="p">)</span>

<span class="c1"># Loop through and add a certain number of aerostruct points</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>

    <span class="n">point_name</span> <span class="o">=</span> <span class="s2">&quot;AS_point_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="c1"># Connect the parameters within the model for each aerostruct point</span>

    <span class="c1"># Create the aero point group and add it to the model</span>
    <span class="n">AS_point</span> <span class="o">=</span> <span class="n">AerostructPoint</span><span class="p">(</span><span class="n">surfaces</span><span class="o">=</span><span class="n">surfaces</span><span class="p">,</span> <span class="n">internally_connect_fuelburn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="n">point_name</span><span class="p">,</span> <span class="n">AS_point</span><span class="p">)</span>

    <span class="c1"># Connect flow properties to the analysis point</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.v&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;Mach_number&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.Mach_number&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;re&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.re&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.rho&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.CT&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.R&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;W0&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.W0&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;speed_of_sound&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.speed_of_sound&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;empty_cg&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.empty_cg&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.L_equals_W.fuelburn&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.total_perf.CG.fuelburn&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">surface</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="p">:</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">surface</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;load_factor&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.load_factor&quot;</span><span class="p">,</span> <span class="n">src_indices</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="n">com_name</span> <span class="o">=</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_perf.&quot;</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.local_stiff_transformed&quot;</span>
        <span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">)</span>

        <span class="c1"># Connect aerodynamic mesh to coupled group mesh</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.mesh&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;struct_weight_relief&quot;</span><span class="p">]:</span>
            <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.coupled.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.element_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect performance calculation variables</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.nodes&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;nodes&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.cg_location&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_cg_location&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.structural_mass&quot;</span><span class="p">,</span> <span class="n">point_name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="s2">&quot;total_perf.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;_structural_mass&quot;</span><span class="p">)</span>

        <span class="c1"># Connect wingbox properties to von Mises stress calcs</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.Qz&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;Qz&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.J&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;J&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.A_enc&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;A_enc&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.htop&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;htop&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hbottom&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hbottom&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hfront&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hfront&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.hrear&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;hrear&quot;</span><span class="p">)</span>

        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.spar_thickness&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;spar_thickness&quot;</span><span class="p">)</span>
        <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.t_over_c&quot;</span><span class="p">,</span> <span class="n">com_name</span> <span class="o">+</span> <span class="s2">&quot;t_over_c&quot;</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1&quot;</span> <span class="o">+</span> <span class="s2">&quot;.alpha&quot;</span><span class="p">)</span>

<span class="c1"># Here we add the fuel volume constraint componenet to the model</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">WingboxFuelVolDelta</span><span class="p">(</span><span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">))</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuel_vols&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_vol_delta.fuelburn&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;distributed_fuel_weight&quot;</span><span class="p">]:</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_0.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;wing.struct_setup.fuel_vols&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_vols&quot;</span><span class="p">)</span>
    <span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;AS_point_1.coupled.wing.struct_states.fuel_mass&quot;</span><span class="p">)</span>

<span class="n">comp</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ExecComp</span><span class="p">(</span><span class="s2">&quot;fuel_diff = (fuel_mass - fuelburn) / fuelburn&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_subsystem</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">promotes_inputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">],</span> <span class="n">promotes_outputs</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">])</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="s2">&quot;fuel_diff.fuelburn&quot;</span><span class="p">)</span>


<span class="c1">## Use these settings if you do not have pyOptSparse or SNOPT</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">ScipyOptimizeDriver</span><span class="p">()</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;SLSQP&quot;</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;tol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-4</span>

<span class="n">recorder</span> <span class="o">=</span> <span class="n">om</span><span class="o">.</span><span class="n">SqliteRecorder</span><span class="p">(</span><span class="s2">&quot;aerostruct.db&quot;</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">add_recorder</span><span class="p">(</span><span class="n">recorder</span><span class="p">)</span>

<span class="c1"># We could also just use prob.driver.recording_options[&#39;includes&#39;]=[&#39;*&#39;] here, but for large meshes the database file becomes extremely large. So we just select the variables we need.</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;includes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
    <span class="s2">&quot;rho&quot;</span><span class="p">,</span>
    <span class="s2">&quot;v&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.cg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing_loads.loads&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.normals&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.widths&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.aero_states.wing_sec_forces&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.CL1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.S_ref&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.geometry.twist&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.skin_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.spar_thickness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.t_over_c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.wing_perf.vonmises&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_0.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AS_point_1.coupled.wing.def_mesh&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_objectives&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_constraints&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_desvars&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prob</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">recording_options</span><span class="p">[</span><span class="s2">&quot;record_inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.twist_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.spar_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.skin_thickness_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.003</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;wing.geometry.t_over_c_cp&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;fuel_mass&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">2e5</span><span class="p">,</span> <span class="n">scaler</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_design_var</span><span class="p">(</span><span class="s2">&quot;alpha_maneuver&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=-</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_0.CL&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.L_equals_W&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;AS_point_1.wing_perf.failure&quot;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_vol_delta.fuel_vol_delta&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prob</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="s2">&quot;fuel_diff&quot;</span><span class="p">,</span> <span class="n">equals</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># Set up the problem</span>
<span class="n">prob</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># om.view_model(prob)</span>

<span class="c1"># prob.check_partials(form=&#39;central&#39;, compact_print=True)</span>

<span class="n">prob</span><span class="o">.</span><span class="n">run_driver</span><span class="p">()</span>
<span class="c1"># prob.run_model()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The fuel burn value is&quot;</span><span class="p">,</span> <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;AS_point_0.fuelburn&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;[kg]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;The wingbox mass (excluding the wing_weight_ratio) is&quot;</span><span class="p">,</span>
    <span class="n">prob</span><span class="p">[</span><span class="s2">&quot;wing.structural_mass&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">surf_dict</span><span class="p">[</span><span class="s2">&quot;wing_weight_ratio&quot;</span><span class="p">],</span>
    <span class="s2">&quot;[kg]&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>There is plenty of room for improvement.
A finer mesh and a tighter optimization tolerance should be used.</p>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick_example.html">Quick Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aero_walkthrough.html">Aerodynamic Optimization Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="struct_example.html">Structural Optimization Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_walkthrough.html">Aerostructural Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="aerostructural_wingbox_walkthrough.html">Aerostructural with Wingbox Walkthrough</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User-Provided Mesh Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="more_examples.html">More Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="specialty_topics.html">Specialty Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="v1_v2_conversion.html">OpenAeroStruct v1 to v2 Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_to_contribute.html">How to Contribute to OpenAeroStruct</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="_srcdocs/index.html">Source Docs</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="more_examples.html" title="More Examples"
             >next</a> |</li>
        <li class="right" >
          <a href="aerostructural_wingbox_walkthrough.html" title="Aerostructural with Wingbox Walkthrough"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">OpenAeroStruct 2.3.2 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">User-Provided Mesh Example</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, John Jasa, Dr. John Hwang, Justin S. Gray.
      Last updated on Jan 30, 2022.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.4.
    </div>
  </body>
</html>